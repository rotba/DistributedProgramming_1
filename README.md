# DistributedProgramming_1
## HOW TO RUN
* Creadentials must be accessible in  `~/.aws/credentials`
* Assuming the project is cloned to GIT_ROOT execute: 
  * `cd GIT_ROOT`
  * `mvn compile assembly:single`
  * `cd target`
  * `java -jar DistributedProgramming_1-1.0-SNAPSHOT-jar-with-dependencies.jar GIT_ROOT/orig_input-sample.txt GIT_ROOT/out.html 1 terminate`

## INSTANCES DETAILS
* AMI - *ami-0fc851119e45cd2a6*
* Instance type - *InstanceType.T2_MICRO* 

## ARCHITECHTURE

### Local App (AKA - LA):
* If a `Manager)` (AKA `MGR`) instance is not running, run a `Manager` instance
* Setup all the `LA` resources if they're not exist:
  * the `s3` bucket of system
  * the `LA->MGR` `sqs`
  * the `MGR->LA` `sqs`
* Upload the input to the `s3` bucket
* Send `MGR` the location of the input file
* Send `MGR` terminate if got `terminate` parameter
* Busy wait for the `MGR` to finish
* Parse the summary from the `MGR` to the output file
* If `terminate` destroy `MGR` instance

### Manager (AKA - MGR)

The manager has 4 constituents (threads)
* `TaskReceiver` (`TR`)
  * Busy waits for messages from `LA`
  * If got `terminate` message - return
  * Sends the `Worker`s message for each line in the input specified in the input file. **A task is globaly identified by `<input_file, index>` which corresponds to the file in the *index* line in a *input_file* generated by an `LA`**
  * incremente a global varable `pendingTasks`
* `ResultsCollector` (`RC`)
  * Busy wait for messages from the `Workers` of the form `<input_file, index, msg?>`
  * Set a flag indicating that the `index` task in `input_file` is done with `msg` (that can be empty)
  * If `index` is the last task in `input_file` generate the summary and send it to `LA` and decrement `pendingTasks`
* `AutoScaler`
  * Forever scale out or terminate instance to satsfy *tasks_amount/n*
* `main`
  * Start `TR`
  * Start `RC`
  * Start `AS`
  * join `TR` (i.e wait until terminate message was reveived)
  * wait until `pendingTasks == 0` (i.e `RC` done and all the tasks have been handled)

### Worker (AKA WKR)
Forever: read message from the `MGR->WKR` queue, execute the task, and send the result
